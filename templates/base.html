<html>

<head>
    <!--  Multi-user-blog App -->

    <link type='text/css' rel='stylesheet' href='/stylesheets/main.css' />
    <link href='https://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
</head>

<body>
    <div class='container-fluid'>
        <!-- NavBar -->
        <nav class='navbar navbar-default'>
            <!-- NavBar brand -->
            <div class='container-fluid'>
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">SUPdate</a>
                </div>

                <!-- NavBar buttons -->
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class='active'><a href="/">Home</a></li>
                        {% if session['username'] %}
                        <li class><a href="/newpost">New Post</a></li>

                        <li class='dropdown'>
                            <a class="dropdown-toggle" data-toggle='dropdown' href="#"
                             role="button" aria-haspopup="true" aria-expanded="false">
                              Logged In as {{session['username']}}
                            <span class="caret"></span></a>
                            <ul class='dropdown-menu'>
                                <li><a href='/profile'>Profile</a></li>
                                <li role ='seperator' class='divider'></li>
                                <li><a href='/logout'>Logout</a></li>
                           </ul>
                        </li>
                      {% else %}
                            <li><a href='/login'>Login</a></li>
                            <li><a href='/signup'>Register</a></li>
                            {% endif %}
                  </ul>
                </div>
            </div>
        </nav>

        <!-- Page Header -->
        <header class="jumbotron">
            <div class="container">
                <div class="site-heading">
                    <h1 class="display-1">SUPdate</h1>
                    <hr class="small">
                </div>
            </div>
        </header>

        <p class='error'>
            {{error}}
        </p>


        {% block content %}
        <!-- all child templates content goes here -->
        {% endblock %}
    </div>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script>
    $(document).ready(function() {
      // increases number of likes for Post object in datastore
        $('button.like-btn').click(function() {
            var post_id = this.id;
            $.post('/', {
                'key': post_id,
                'like': true
            }).done(function(response) {
                response = $.parseJSON(response);
                $('div#' + post_id + '> p').text(response['num_likes'] + ' people like this!');
                $('button#' + post_id + '.like-btn').addClass("hidden");
                $('button#' + post_id + '.unlike-btn').removeClass("hidden");
            }).fail(function() {
                alert('Failed to reach server');
            });
        });

        // decrements num of likes by 1 and shows like button
        $('button.unlike-btn').click(function() {
            var post_id = this.id;
            $.post('/', {
                'key': post_id,
                'unlike': true
            }).done(function(response) {
                response = $.parseJSON(response);
                $('div#' + post_id + '> p').text(response['num_likes'] + ' people like this!');
                $('button#' + post_id + '.unlike-btn').addClass("hidden");
                $('button#' + post_id + '.like-btn').removeClass("hidden");
            }).fail(function() {
                alert('Failed to reach server');
            });
        });

        // new comment button inserts comment in database and updates homepage
        $('button.new_comment').click(function() {
            if ("{{session['username']}}") {
                var post_id = this.id;
                var comment = $('div.new_comment input:text').val();
                $.post('/', {
                    'key': post_id,
                    'comment': comment
                }).done(function(response) {
                    response = $.parseJSON(response);
                    var comment = response['comment'];
                    var time_stamp = response['time_stamp'];
                    console.log(time_stamp);
                    var input = '<li>{{session.username}} says ' + comment + ' ' +
                        time_stamp + '</li>';
                    $('#' + post_id + 'comments').append(input);
                }).fail(function() {
                    alert('Failed to reach server');
                });
            } else {
                $('p.error').text('You need to login or register to comment.');
            }
        });
        return false;
    });
    </script>
</body>

</html>
